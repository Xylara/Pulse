<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" sizes="32x32" src="/others/pulse.png" />
  <title>Pulse - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-r from-gray-900 to-gray-800 font-sans text-white antialiased min-h-screen">
  <%- include('parts/sidebar', { user: user, users: users }) %>
  <main class="ml-56 md:ml-64 p-8 min-h-screen">

    <% if (typeof message !== 'undefined' && message) { %>
    <div class="mb-4 p-3 rounded-md <%= message.type === 'success' ? 'bg-green-500 text-white' : '' %> <%= message.type
      === 'error' ? 'bg-red-500 text-white' : '' %> <%= message.type === 'warning' ? 'bg-yellow-500 text-gray-900' : ''
      %> <%= message.type === 'info' ? 'bg-blue-500 text-white' : '' %>">
      <%= message.text %>
    </div>
    <% } %>

    <section class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8">
      <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Send Friend Request</h2>
      <form action="/dashboard/add-friend" method="POST" class="flex flex-col sm:flex-row items-center gap-4">
        <input type="text" name="friendUsername" placeholder="Enter username"
          class="flex-grow p-3 rounded-lg bg-gray-700 text-white focus:bg-gray-600 outline-none transition" required />
        <button type="submit"
          class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-300">
          Send Request
        </button>
      </form>
    </section>

    <section class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8">
      <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Received Friend Requests</h2>
      <% if (user.receivedFriendRequests && user.receivedFriendRequests.length> 0) { %>
      <ul class="space-y-3">
        <% user.receivedFriendRequests.forEach(requester => { %>
        <li class="flex items-center justify-between bg-gray-700 p-3 rounded-md">
          <span class="text-lg"><%= requester %></span>
          <div class="flex gap-2">
            <form action="/dashboard/accept-friend-request" method="POST">
              <input type="hidden" name="requesterUsername" value="<%= requester %>">
              <button type="submit"
                class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 text-sm">Accept</button>
            </form>
            <form action="/dashboard/reject-friend-request" method="POST">
              <input type="hidden" name="requesterUsername" value="<%= requester %>">
              <button type="submit"
                class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 text-sm">Reject</button>
            </form>
          </div>
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <p class="text-gray-400">No pending friend requests.</p>
      <% } %>
    </section>

    <section class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8">
      <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Sent Friend Requests</h2>
      <% if (user.sentFriendRequests && user.sentFriendRequests.length> 0) { %>
      <ul class="space-y-3">
        <% user.sentFriendRequests.forEach(sentTo => { %>
        <li class="flex items-center justify-between bg-gray-700 p-3 rounded-md">
          <span class="text-lg"><%= sentTo %></span>
          <span class="text-gray-400 text-sm">Pending</span>
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <p class="text-gray-400">No outgoing friend requests.</p>
      <% } %>
    </section>

    <section class="bg-gray-800 p-6 rounded-lg shadow-lg">
      <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">Your Friends</h2>
      <% if (user.friends && user.friends.length> 0) { %>
      <ul class="space-y-3">
        <% user.friends.forEach(friend => { %>
        <li class="flex items-center bg-gray-700 p-3 rounded-md">
          <span class="text-lg"><%= friend %></span>
        </li>
        <% }); %>
      </ul>
      <% } else { %>
      <p class="text-gray-400">You don't have any friends yet. Send a request!</p>
      <% } %>
    </section>

  </main>
</body>

</html>